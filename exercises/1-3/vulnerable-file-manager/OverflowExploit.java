/**
 * Exploit for Guideline 1-3 (DOS-3): Resource limit checks should not suffer
 * from integer overflow.
 */
public class OverflowExploit {
    public static void main(String[] args) {
        VulnerableFileManager manager = new VulnerableFileManager();

        // We want numUsers * filesPerUser to overflow.
        // Let's use 1,000,000 users and 3,000 files each.
        // 1,000,000 * 3,000 = 3,000,000,000
        // (int)3,000,000,000 = -1,294,967,296

        int numUsers = 1000000;
        int filesPerUser = 3000;

        System.out.println("--- Starting Integer Overflow Exercise ---");
        System.out.println("System Limit: 5000 files\n");

        boolean result = manager.requestFiles(numUsers, filesPerUser);

        if (result) {
            System.out.println("\nSUCCESS: The exploit bypassed the limit check!");
        } else {
            System.out.println("\nFAILURE: The exploit was blocked.");
        }

        // After fixing the code, you can test the secure version by uncommenting the
        // following lines:
        // System.out.println("\nRunning Secure Manager:");
        // SecureFileManager secureManager = new SecureFileManager();
        // secureManager.requestFiles(numUsers, filesPerUser);
    }
}
