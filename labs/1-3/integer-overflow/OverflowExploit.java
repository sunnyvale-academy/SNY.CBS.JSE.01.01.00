/**
 * Exploit for Guideline 1-3 (DOS-3): Resource limit checks should not suffer
 * from integer overflow.
 * 
 * This class demonstrates how to bypass a vulnerable limit check using integer
 * overflow.
 */
public class OverflowExploit {
    public static void main(String[] args) {
        VulnerableResourceAllocator vulnerable = new VulnerableResourceAllocator();
        SecureResourceAllocator secure = new SecureResourceAllocator();

        // 1MB = 1,048,576 bytes.
        // We want numElements * elementSize to be slightly larger than MAX_VALUE to
        // overflow to a small positive number.
        // Let's use two values that multiply to something larger than 2^31 - 1.

        // Example: 1,000,000 * 3,000 = 3,000,000,000
        // 3,000,000,000 - 2^32 (overflow) = -1,294,967,296

        // Let's find values that overflow to a small positive value within the 1MB
        // limit.
        // (int) 2,148,483,648 (which is 2^31 + 1,000,000 approx)
        // If we use numElements = 1,048,576 + 1 and elementSize = 2048? No.

        // Let's pick:
        int numElements = 1000000;
        int elementSize = 3000;
        // 1,000,000 * 3,000 = 3,000,000,000
        // (int)3,000,000,000 = -1,294,967,296 (negative, bypasses > limit check if
        // limit is positive)

        System.out.println("--- Starting Integer Overflow Lab ---");
        System.out.println("Target Limit: 1,048,576 bytes\n");

        System.out.println("Running Vulnerable Allocator:");
        vulnerable.allocate(numElements, elementSize);

        System.out.println("\n-------------------------------------\n");

        System.out.println("Running Secure Allocator:");
        secure.allocate(numElements, elementSize);
    }
}
