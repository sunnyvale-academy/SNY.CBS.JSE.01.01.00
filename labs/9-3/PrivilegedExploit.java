/**
 * PrivilegedExploit.java
 * 
 * This class demonstrates how an untrusted caller can hijack a privileged
 * action to access system resources.
 */
public class PrivilegedExploit {
    public static void main(String[] args) {
        System.out.println("=== Lab 9-3: Safely invoke doPrivileged ===\n");

        VulnerablePrivilegedAction vulnerableService = new VulnerablePrivilegedAction();
        SecurePrivilegedAction secureService = new SecurePrivilegedAction();

        // 1. Authorized read (a file the service is supposed to manage)
        String configFile = "config/app.properties";
        System.out.println("[Step 1] Requesting authorized file: " + configFile);
        vulnerableService.readFile(configFile);

        // 2. Exploit: Requesting a sensitive system file
        // The service will use its own higher privileges to attempt this read,
        // ignoring the fact that the caller might be untrusted.
        String sensitiveFile = "/etc/passwd";
        System.out.println("[Step 2] Exploiting Vulnerable Service to read: " + sensitiveFile);
        vulnerableService.readFile(sensitiveFile);

        // 3. Attempting the same on the Secure Service
        System.out.println("[Step 3] Attempting to exploit Secure Service to read: " + sensitiveFile);
        try {
            secureService.readFile(sensitiveFile);
        } catch (SecurityException e) {
            System.err.println("CAUGHT EXCEPTION: " + e.getMessage());
            System.out.println("The Secure Service successfully blocked the unauthorized privileged operation.");
        }
    }
}
